class GameRunner {
	field int direction;
	field Basket basket;
<<<<<<< HEAD
	field Bomb bomb;
	field Drop d1, d2, d3, d4, d5;
=======
>>>>>>> 507b5d7f6dec1e46569a38538d4fe2edc1cf6fb9
	field Array allDrops;
	field int score;
	field int numOfDrops;

	
	/** Constructs a new Square Game. */
	constructor GameRunner new() {
		let basket = Basket.new(220, 230);
		let bomb = Bomb.new(50,2);
		let direction = 0;
		let score = 0;
		let numOfDrops = 5;
		do generateDrops();
		do gameBoard();
		return this;
    }
	
	method void updateGame() {
		var int speed;
		var int i;
		var Drop d;
		var boolean isCollision;
		let i = 0;
		while (i<numOfDrops) {
			let d = allDrops[i];
			do d.startFalling();
			let isCollision = checkCollision(d);
			if (isCollision) {
				do d.erase();
				do basket.blink();
				let speed = d.getSpeed();
				let allDrops[i] = Drop.new(d.getX(),(speed+1));
				do d.dispose();
				do printScore();
				
			}
			let i = i + 1;
		}
		if (direction = 1) {	// left key pressed
			do basket.moveLeft();
		}
		if (direction = 2) {	// right key pressed
			do basket.moveRight();
		}
	return;
	}
   	
	method void runFullGame() {
		var char key;
		var boolean exit;
		let exit = false;
      
		while (~exit) {
			// waits for a key to be pressed
			while (key = 0) {
				let key = Keyboard.keyPressed();
				do updateGame();
			}
			if (key = 81)  { let exit = true; }     // q key
			if (key = 130) { let direction = 1; }   // left arrow
			if (key = 132) { let direction = 2; }   // right arrow

			// waits for the key to be released
			while (~(key = 0)) {
				let key = Keyboard.keyPressed();
				do updateGame();
			}
			let direction = 0;
		} // end of while loop
		return;
	}
	
	method void generateDrops() {
		var int i;
		var int len;
		let allDrops = Array.new(5);
		let i = 0;
		while(i<numOfDrops) {
			let allDrops[i] = Drop.new((i*i*20)+50,1);
			let i = i + 1;
		}
		return;
	}
	method boolean checkCollision(Drop d){
		var int xBasket;
		var int yBasket;
		var int dx;
		var int dy;
		let xBasket = basket.getX();
		let yBasket = basket.getY();
		let dx = d.getX();
		let dy = d.getY();

		if ((dx > xBasket) & (dx < (xBasket+50)) & (dy > (yBasket-4)) & (dy < (yBasket+5))) {
			let score = score + 1;
			return true;
		}
	return false;
	}
	
	method void printScore() {
		do Output.moveCursor(0,46);
		do Output.printInt(score);
		return;
	}
	
	method void gameBoard () {
		do Output.moveCursor(0,1);
		do Output.printString("HUNGRY BASKET                    Game Score: ");
		do printScore();
		
		return;
	}

}
